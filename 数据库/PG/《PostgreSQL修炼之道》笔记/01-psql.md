# psql

* 为什么不需要输入用户名和密码？
  * 安装PostgreSQL数据库时，会建立一个与初始化数据库时的操作系统用户同名的数据库用户，同时这个用户是数据库的超级用户，在这个操作系统用户下，登录数据库执行的是操作系统认证，所以不需要用户名和密码。可以通过修改pg_hba.conf文件来要求输入密码。
* 关于数据库`postgres`, `template0`, `template1`
  * 安装完成后，默认会有一个叫`postgres`的数据库，还有两个模版数据库`template0`和`template1`。
  * 当用户建立数据库时，默认是从模版数据库`template1`克隆出来的，所以通常可以定制`template1`数据库中的内容（表、函数等等），使得之后创建的数据库继承。
  * `template0`是一个最简化的模版库，创建数据库时，如果明确指定从该数据中继承，将创建一个最简化的数据库。

## psql的一些命令

### `\d`命令

* `\d [pattern][+]`：显示每个匹配关系的信息，带`+`时将显示更详细的信息
* 匹配不同对象类型的`\d`命令
  * `\dt`：只显示匹配的表
  * `\di`：只显示匹配的索引
  * `\ds`：只显示匹配的序列
  * `\dv`：只显示匹配的视图
  * `\df`：只显示匹配的函数
  * `\dn`：只显示匹配的schema // TODO 仍有疑问，这里的schema指的是？
  * `\db`：只显示匹配的表空间（实际上PG的表空间就是一个目录，放在这个表空间的表，其数据文件就在对应目录）
  * `\dg`或`\du`：只显示匹配的角色或用户（两个命令等价，因为PG数据库中角色与用户不分）
  * `\dp`或`\z`：显示表的权限分配情况
  * `\l`：列出所有数据库

### `\pset`命令

* 用于设置输出的格式
  * 例如：`\pset border 0`表示输出内容无边框，`\pset border 1`表示输出内容只有内边框，`\pset border 2`表示输出内外都有边框。

### 执行文件中的SQL

* 交互模式下，使用`\x <文件名>`
* 非交互模式下，使用`psql -f <文件名>`

### 其他常用命令

* `\timing [on|off]`：显示或不显示SQL执行的时间
* `\encoding [gbk|utf8|...]`：设置客户端的字符编码
* `\x [on|off]`：可以将表中的每一行的每列数据拆分为单行展示
* `\echo <想要展示的提示信息>`

## psql的一些注意事项

* psql中事务是自动提交的，如果不想自动提交，方法有两种：
  * 运行`begin;`，然后执行sql，最后执行`commit;`或`rollback;`
  * 或者通过`\set AUTOCOMMIT off`直接关闭自动提交的功能

* `\set ECHO_HIDDEN [on|off]`：Echo the actual queries generated by \d and other backslash commands.
  * 或者运行`psql`时增加参数`-E`
